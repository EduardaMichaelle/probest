---
title: "Pre√ßos de combust√≠vel no Brasil"
author: "üë©üèΩ‚Äçüíª Eduarda Michaelle"
github: 'https://github.com/EduardaMichaelle'
date: '(data: `r format(Sys.Date(), "%d/%m/%Y")`)'
lang: 'pt-br'
output:
  html_document:
    toc: true
    toc_depth: 3
---

```{r pacotes}
install.packages("tidyverse")
install.packages("summarytools")
install.packages("lubridate")
```

```{r bibliotecas}
library(tidyverse)
library(lubridate)
library(summarytools)
```

# Leitura e limpeza de dados

```{r leitura-arq}
combustivel_info <- read_tsv(
  '2004-2021.tsv'
  )
```

```{r glimpse}
glimpse(combustivel_info)
```
* Verificando se h√° valores faltantes `(NA)`:

```{r verifica-na}
# Usando a fun√ß√£o any para testar se h√° pelo menos 1 valor ausente em uma coluna dos dados.
any(is.na(combustivel_info))
```

# An√°lise Explorat√≥ria

* Verificando a quantidade de combust√≠veis diferentes analisados:

```{r comb-analisados}
table(combustivel_info$PRODUTO)
```
* Qual o menor pre√ßo que cada combust√≠vel teve entre todos os anos analisados? E o maior? 

```{r min-pre√ßo-comb}
combustivel_info %>% 
  group_by(PRODUTO) %>% 
  summarize(`MENOR PRE√áO` = min(`PRE√áO M√âDIO REVENDA`)) %>% 
  arrange(`MENOR PRE√áO`)
```

```{r max-pre√ßo-comb}
combustivel_info %>% 
  group_by(PRODUTO) %>% 
  summarize(`MAIOR PRE√áO` = max(`PRE√áO M√âDIO REVENDA`)) %>% 
  arrange(`MAIOR PRE√áO`)
```

* Total de postos pesquisados por todo Brasil (desde 2004):

```{r total-postos}
postos <- combustivel_info['N√öMERO DE POSTOS PESQUISADOS']
sum(postos)
```

* M√©dia do pre√ßo dos combust√≠veis no Brasil em 2004:

```{r media-2004}
# Inserindo a coluna DATA INICIAL em datas
DATAS <- combustivel_info['DATA INICIAL']
# Inserindo a coluna PRE√áO M√âDIO REVENDA em PRE√áOS
PRE√áOS <- combustivel_info['PRE√áO M√âDIO REVENDA']
# Inserindo a coluna PRODUTO em COMBUST√çVEL
COMBUST√çVEL <- combustivel_info['PRODUTO']
# Inserindo a coluna ESTADO em EST 
EST <- combustivel_info['ESTADO']

# Criando um for para armazenar no vetor ANOS, apenas os anos das datas da tabela DATAS
for (elem in DATAS)
{
  ANOS <- year(elem)
}

# Criando uma tabela com DATAS, PRE√áOS e ANOS
tabela <- tibble(DATAS, EST, PRE√áOS, COMBUST√çVEL, ANOS)

# Filtrando as linhas com os anos = 2004 e criando outra tabela apenas com os pre√ßos de 2004 
anos_2004 <- tabela %>% filter(ANOS==2004) %>%
  arrange(`DATA INICIAL`)

# Imprimindo a tabela com os pre√ßos m√©dios de 2004
anos_2004 

# Imprimindo a m√©dia
anos_2004 %>%
  pull("PRE√áO M√âDIO REVENDA") %>%
  mean()
```

* M√©dia do pre√ßo do combust√≠vel no Brasil em 2021:

```{r media-2021}
DATAS <- combustivel_info['DATA INICIAL']
PRE√áOS <- combustivel_info['PRE√áO M√âDIO REVENDA']
COMBUST√çVEL <- combustivel_info['PRODUTO']
EST <- combustivel_info['ESTADO']

for (elem in DATAS)
{
  ANOS <- year(elem)
}

tabela <- tibble(DATAS, EST, PRE√áOS, COMBUST√çVEL, ANOS)
anos_2021 <- tabela %>% filter(ANOS==2021)

anos_2021

anos_2021 %>%
  pull("PRE√áO M√âDIO REVENDA") %>%
  mean()
```

‚ûû Podemos perceber que em 17 anos o pre√ßo m√©dio dos combust√≠veis dobrou. 

* As informa√ß√µes apenas do estado do Rio de Janeiro (2004-2021):

```{r rio-info}
combustivel_info %>% 
  filter(ESTADO == 'RIO DE JANEIRO')
```

* O estado que teve o menor pre√ßo m√©dio de combust√≠vel (2004-2021)?

```{r est-menor-pre√ßo-medio}
# Criando uma tabela ordenada pelo pre√ßo m√©dio (do menor para o maior)
comb_EST <- combustivel_info %>% arrange(`PRE√áO M√âDIO REVENDA`)

# Imprimindo apenas a primeira linha da tabela
comb_EST %>%
  slice_head()
```

* O estado que teve o maior pre√ßo m√©dio de combust√≠vel (2004-2021)?

```{r est-maior-pre√ßo-medio}
comb_EST <- combustivel_info %>% arrange(`PRE√áO M√âDIO REVENDA`)

# Imprimindo apenas a √∫ltima linha da tabela
comb_EST %>%
  slice_tail()
```

‚ûû Observamos que o pre√ßo m√©dio mais barato foi de 0.766 em maio de 2004, e o mais caro foi de 107.5 em mar√ßo de 2021. Ser√° que os pre√ßos aumentaram gradativamente a cada ano desde 2004? Ou ser√° que houveram anos melhores que outros? 

* Sum√°rio 

```{r sum√°rio}
combustivel_info %>% dfSummary() %>% print(method = 'render')
```

# Tipos de gr√°ficos

## Scatter plots

* Vamos analisar o pre√ßo m√©dio dos combust√≠veis do <b>Rio de Janeiro</b> em 2004 e 2021:

```{r scatter-plots}
anos_2004 %>% 
  filter(ESTADO == 'RIO DE JANEIRO') %>% 
  ggplot(aes(x = `PRE√áO M√âDIO REVENDA`, y = `DATA INICIAL`, color = PRODUTO)) +
  geom_point() +
  labs(
      title = 'PRE√áO M√âDIO EM RELA√á√ÉO AO M√äS',
      x = 'PRE√áO M√âDIO',
      y = 'M√äS'
    ) 

anos_2021 %>% 
  filter(ESTADO == 'RIO DE JANEIRO') %>% 
  ggplot(aes(x = `PRE√áO M√âDIO REVENDA`, y = `DATA INICIAL`, color = PRODUTO)) +
  geom_point() +
  labs(
      title = 'PRE√áO M√âDIO EM RELA√á√ÉO AO M√äS',
      x = 'PRE√áO M√âDIO',
      y = 'M√äS'
    ) 
```

## Histograma 

* N√∫mero de postos pesquisados no Rio de Janeiro

```{r histograma}
combustivel_info %>%
  filter(ESTADO == 'RIO DE JANEIRO') %>%
  ggplot(aes(x = `N√öMERO DE POSTOS PESQUISADOS`)) +
    geom_histogram() + 
  scale_x_continuous(breaks = seq(-100, 2000, 2000)) +
  labs(
    y = NULL,
    x = 'POSTOS',
    title = 'N√öMERO DE POSTOS PESQUISADOS NO RIO DE JANEIRO',
  )
```

## Boxplot

* Pre√ßo m√©dio dos combust√≠veis automotivos do Brasil em 2004: 

```{r remove-glp}
# Removendo as linhas com "GLP" de um Data Frame
comb_auto_2004 <- anos_2004[!grepl("GLP",anos_2004$PRODUTO),]
comb_auto_2021 <- anos_2021[!grepl("GLP",anos_2021$PRODUTO),]

#Confirmando que as linhas do combust√≠vel GLP foram apagadas
comb_auto_2004%>%
  filter(PRODUTO == 'GLP')
comb_auto_2021%>%
  filter(PRODUTO == 'GLP')
```
```{r pre√ßo-m√©dio-rj}
boxp_2004 <- comb_auto_2004 %>% 
  ggplot(aes(x = PRODUTO, y = `PRE√áO M√âDIO REVENDA`)) +
  geom_boxplot(fill = 'gray') +
  scale_y_continuous(breaks = seq(0, 5, 0.25))+
  labs(
    title = "PRE√áO M√âDIO DOS COMBUST√çVEIS AUTOMOTIVOS EM 2004",
    x = NULL,
    y = NULL
  ) 
boxp_2004

boxp_2021 <- comb_auto_2021 %>% 
  ggplot(aes(x = PRODUTO, y = `PRE√áO M√âDIO REVENDA`)) +
  geom_boxplot(fill = 'gray') +
  scale_y_continuous(breaks = seq(0, 10, 0.25))+
  labs(
    title = "PRE√áO M√âDIO DOS COMBUST√çVEIS AUTOMOTIVOS EM 2021",
    x = NULL,
    y = NULL
  ) 

boxp_2021 +
  theme(
    axis.text.x = element_text(
      angle = 45,
      vjust = .9,
      hjust = .9
    )
  )

```

## Barra e colunas

* Frequ√™ncia da an√°lise dos combust√≠veis em cada regi√£o do Brasil.

```{r barra-colunas}
combustivel_info %>% 
  ggplot(aes(x = fct_rev(fct_infreq(REGI√ÉO)), fill = PRODUTO)) +
    geom_bar(position = 'dodge') +
    labs(
      x = NULL,
      y = NULL
    ) +
    scale_y_continuous(breaks = seq(0, 8000, 500))
```

* Experimentando uma paleta de cores diferente: 

```{r barra-colunas-cores}
combustivel_info %>% 
  ggplot(aes(x = fct_rev(fct_infreq(REGI√ÉO)), fill = PRODUTO)) +
    geom_bar(position = 'dodge') +
    labs(
      x = NULL,
      y = NULL
    ) +
    scale_y_continuous(breaks = seq(0, 8000, 500)) +
    scale_fill_discrete(
      type = c('#b7ded2', '#ffbdbd', '#f7c297', '#ffecb8', '#90d2d8', '#e0d6ff', '#3b5998', '#78866b', '#4d5d53')
    )
```

## Gr√°fico de linha

* N√∫mero de postos pesquisados em cada regi√£o do Brasil (2004-2021):

```{r tibble-postos-info}
# Criando uma tibble com as colunas ANO, REGI√ÉO e N√öMERO DE POSTOS
DATAS <- combustivel_info['DATA INICIAL']
NUM_POSTOS <- combustivel_info['N√öMERO DE POSTOS PESQUISADOS']
REG <- combustivel_info['REGI√ÉO']

for (elem in DATAS)
{
  ANO <- year(elem)
}

postos_info <- tibble(ANO, REG, NUM_POSTOS)
postos_info
```

```{r aggregate}
# Usando a fun√ß√£o aggregate para somar, por regi√£o, todos os postos pesquisados em cada ano
postos_info = aggregate(x = postos_info$`N√öMERO DE POSTOS PESQUISADOS`, by = list(postos_info$ANO, postos_info$REGI√ÉO), FUN = "sum")

postos_info
```
```{r rename-colunas-postos-info}
# Renomeando as colunas 
colnames(postos_info) <- c("ANO", "REGI√ÉO", "N√öMERO DE POSTOS")
postos_info
```

```{r gr√°fico-de-linha}
# Criando o gr√°fico 
postos_info %>% 
  ggplot(aes(x = ANO, y = `N√öMERO DE POSTOS`, color = REGI√ÉO)) +
    geom_line() +
    scale_x_continuous(breaks = 2004:2021) +
    theme(axis.text.x = element_text(angle = 50))
    labs(
      y = "POSTOS PESQUISADOS",
      x = "ANOS"
    )
```
* <b>9e+05* = 9*10^5 = 900.000

# Bibliografia 

* [R is.na Function Example (remove, replace, count, if else, is not NA)](https://statisticsglobe.com/r-is-na-function/)
* [Ci√™ncia de Dados com R - Manipulando os dados](https://cdr.ibpad.com.br/manipulando-os-dados.html)
* [Ci√™ncia de Dados com R - Trabalhando com datas](http://sillasgonzaga.com/material/cdr/trabalhando-com-datas.html)
* [Como excluir linhas de DATAFRAME R com base na correspond√™ncia de Strings?](https://acervolima.com/como-excluir-linhas-de-dataframe-r-com-base-na-correspondencia-de-string/)
* [Remova linhas duplicadas por coluna em R](https://www.delftstack.com/pt/howto/r/remove-duplicates-in-r/)
* [Como alterar o nome de uma coluna?](https://pt.stackoverflow.com/questions/126900/como-alterar-o-nome-de-uma-coluna)
* [Aggregate in R](https://r-coder.com/aggregate-r/)










